# Delta Up and Running
> 2024.6 부터, [Delta Lake: Up & Running](https://www.databricks.com/resources/ebook/delta-lake-running-oreilly) 읽기 시작

## 1. 데이터 아키텍처의 진화

### 개요
> 데이터 엔지니어는 대규모 데이터, 기계학습, 데이터과학 및 AI 솔루션을 구축하고, 이를 위한 데이터를 수집, 정리, 정규화 및 통합하고
> 궁극적으로 손쉽게 이용할 수 있는 데이터 모델링을 제공하고 이러한 데이터를 다운스트림 애플리케이션에서 활용가능한 서비스를 제공해야 합니다

#### 데이터 처리 요구사항
* 수집해야 하는 데이터의 양이 수평적으로 증가함에 따라 저장 및 처리를 위한 리소스 확장이 필요하며
* 대용량 데이터에 대해 지속적으로 레코드 삽입, 업데이트 및 병합 등의 트랜잭션이 필요할 수 있습니다

#### 패러다임의 진화 
* 데이터웨어하우스 : 트랜잭션과 안정적인 스키마 및 모델링을 제공
* 데이터레이크 : 수평적인 확장과 대용량 데이터 저장 및 처리 기능을 제공
* 레이크하우스 : `Delta Lake` 와 같은 분산 저장소 저장 프레임워크를 활용하여 확장성, 성능 그리고 트랜잭션 안정성을 모두 제공

#### 관계형 데이터베이스의 역사
> SQL 언어는 1980년대와 1990년대 엔터프라이즈 애플리케이션의 표준 기술이었고, 트랜잭션 지원으로 가장 강력한 데이터 도구로 자리매김 했습니다
> 이 트랜잭션은 데이터를 처리하는 데에 있어 ACID (원자성, 일관성, 격리성 및 내구성)한 속성을 보장하기 때문에 안전한 데이터 처리가 가능합니다

* 독립된 엔진을 통해 저장해야 해서, 데이터 사일로가 증가하게 되었고, 전사적인 데이터 관리 및 분석을 위해 데이터웨어하우스가 등장합니다
* 데이터웨어하우스는 장기간에 걸친 데이터 분석 및 다양한 차원(고객, 제품, 사업체 등)을 통해 교차 분석이 가능하게 합니다
![데이터웨어하우스 아키텍처](images/datawarehouse-architecture.png)

* 데이터웨어하우스는 다양한 소스로부터 데이터입수를 하기 위해 표준화된 형식으로 변환 후 다운스트림 프로세스가 접근가능한도록 제공해야 합니다
* 데이터 입수, 변환 및 적재를 ETL 이라하며, 데이터가 커지고 사용자가 늘어남에 따라 통합된 뷰를 제공하기 위해 모델링(스키마)를 도입합니다
* 뿐만 아니라 데이터 거버넌스 표준을 제공하기 위해 다양한 품질검사와, 검증을 위한 후처리 작업이 필요합니다
* 데이터웨어하우스는 전통적인 데이터베이스 기반의 서비스이므로 모놀리식 아키텍처 기반으로 구성 및 서비스하는 경우가 가장 많습니다
* 이렇게 구성된 데이터는 내/외부 시스템, 보고서, 온라인 분석 (OLAP) 및 데이터 마이닝 등에 활용됩니다
![판매 차원 모델](images/sales-star-schema.png)

#### 데이터웨어하우스의 특징
* 공통된 스키마를 통해 정제되고 정규화된 고품질 데이터를 제공합니다
* 시간 차원을 기본으로 저장 및 처리하므로 과거로부터 현재까지의 기간 추세분석을 통한 통찰력을 제공합니다
* ACID 한 트랜잭션을 제공하며, 스타 스키마 모델링 기반의 팩트 및 요약 테이블을 통해 다양한 분석이 가능합니다
* 기본적으로 "어떤 사건이 발생했는가?"라는 질문을 해결하는 비즈니스 인텔리전스 서비스라고 볼 수 있습니다
* 다만, 대용량 데이터의 4V(Volume, Velocity, Variety, Veracity 등) 문제를 해소하기는 어렵습니다

#### 데이터레이크 소개
> 초기 데이터레이크는 아파치 하둡 프레임워크를 기반으로 온프레미스 클러스터로 구축되었습니다
> 하둡 서비스 상에 다양한 오픈소스 에코시스템을 활용하여 빅데이터 처리를 위한 환경을 구성할 수 있습니다
![데이터 레이크](images/data-lake.png)

#### 데이터레이크의 특징
* 하둡은 분산 저장소(스토리지), 컴퓨팅 엔진을 제공하며, 오픈소스 에코시스템을 통해 다양한 포맷 및 메타데이터를 활용할 수 있습니다
* 저장 및 처리 시스템의 확장 및 배포가 안정적으로 가능하며, 비정형 데이터를 포함한 모든 데이터 유형을 지원합니다
* 데이터를 수집하는 것과 이러한 데이터를 비즈니스 가치를 제공하는 형식으로 변환 및 유지하는 데에는 많은 비용과 노하우가 필요하게 됩니다
* 조직의 데이터 팀은 데이터를 데이터 웨어하우스와 같은 것으로 변환하고 서빙하는 과정에서 가치 창출 시간이 지연될 수 있음을 알아야 합니다

> 데이터 레이크의 가장 핵심 가치는 **데이터 파이프라인의 자동화와 안정성** 그리고 **가치 창출에 필요한 데이터를 딜리버리 하는 시간을 단축**하는 데에 있다

#### 데이터 레이크 하우스
> Armbrust, Ghodsi, Xin, Zaharia 는 2021년에 데이터 레이크하우스 개념을 처음으로 도입했고, 이는 "ACID 트랜잭션, 데이터 버전관리, 감사
> 색인, 캐싱 및 쿼리 최적화" 등의 기술을 통해 데이터레이크 환경에서 데이터웨어하우스 기능을 제공하는 데이터 관리시스템으로 정의합니다
> 즉, 데이터레이크의 확장성, 처리 성능을 보장하면서 데이터웨어하우스의 트랜잭션, 스키마 모델링의 안정성을 보장하는 시스템입니다

#### 데이터 레이크하우스의 특징
> 데이터레이크와 같이 별도의 데이터 사본을 보관하고 저장할 필요가 없기 때문에, 데이터 이동이 줄어들고 ETL 단순화를 통해 품질 이슈를 줄입니다
> 대용량 데이터 저장과 정제된 차원 모델을 통해 개발주기 감소와 가치 창출에 이르는 시간을 단축할 수 있습니다
![데이터 아키텍처의 진화](images/evolution-of-data-architecture.png)

#### 델타 레이크
> 메타데이터, 캐싱 및 인덱싱을 스토리지 수준에서 제공하는 개방형 데이터 포맷(Parquet)을 지향하는 데이터 저장 프레임워크입니다
> 이는 ACID 트랜잭션, 감사, 히스토리 및 테이블 관리기능을 제공하는 추상화 수준을 API 및 SQL 수준에서 지원합니다

* ACID 트랜잭션, DML 지원, 감사, 배치/스트리밍 처리 통합, 스키마 에볼루션, 메타데이터 지원 등의 주요 기능이 제공됩니다
![델타레이크 계층형 아키텍처](images/delta-lake-architecture.png)

#### 메달리온 아키텍처
> 브론즈, 실버 및 골드 레이어로 데이터의 활용 및 특성에 따라 구분하는 데이터 관리 아키텍처를 말합니다
![메달리온 아키텍처](images/medallion-architecture.png)

* 원본 데이터를 그대로 보관 및 저장하는 `브론즈`, 정규화, 정재 및 병합된 데이터가 보관되는 `실버` 그리고 안전하게 사용할 수 있는 팩트, 요약
* 테이블 등이 저장되는 `골드` 레이어로 구분됩니다

#### 결론
> 데이터의 양, 속도, 다양성 등을 고려할 때 데이터웨어하우스와 데이터레이크의 한계와 과제는 새로운 데이터 패러다임을 주도했습니다
> 델타 레이크와 같은 개방형 테이블 형식으로의 발전을 통해 제안된 데이터 레이크하우스 아키텍처는 이전 버전의 데이터 플랫폼의 통합이 가능했고
> 이를 통해 확장성, 안정성 및 다양한 기능을 제공하는 현대적인 데이터 아키텍처를 지원할 수 있었습니다




## 2. 델타 레이크 시작하기

## 3. 델타 테이블 기본 명령어


