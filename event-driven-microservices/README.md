# Building Event-Driven Microservices
> 2024.12.10 부터 읽기 시작

## 1장. 왜 이벤트 기반 마이크로서비스인가?

### 1-1. 이벤트 기반 마이크로서비스?
> 이벤트를 생산/소비하는 마이크로 서비스 아키텍처

### 1-2. 도메인 주도 설계와 경계 콘텍스트
* 도메인 : 비즈니스 존재 여부와 무관하게 어떠한 주제 자체를 말하는 듯 하다 (ex_ 엔터테인먼트 혹은 게임 데이터)
* 하위 도메인 : 메인 도메인을 구성하는 하위 컴포넌트 (ex_ 모바일 게임 데이터)
* 도메인 모델 : 비즈니스 용도에 맞게 실제 도메인을 추상화한 비즈니스에서 가장 중요한 도메인 조각 및 속성을 통한 모델 (ex_ JoM 실시간 지표)
  * 도메인 모델이 마이크로 서비스 단위 정도로 이해되며, 이를 기반으로 경계 콘텍스트 구축이 가능하지 않을까?
* 경계 콘텍스트 : 입력, 출력, 이벤트, 요건, 프로세스, 데이터 모델 등 하위 도메인과 연관된 논리적 경계 (ex_ 모바일 디바이스, 서버 장비) 
  - 경계 콘텍스트가 마이크로 서비스들의 조합으로 비즈니스 목표 달성이 가능할 것으로 판단

### 1-3. 통신 구조
* 비즈니스 통신 구조 : 팀과 부서간의 통신을 위해 각 팀에 할당된 역할과 책임에 따라 달라지는 통신 구조
  * 외부 커뮤니케이션 채널 팀에서 데이터 엔지니어링 팀에 데이터 수집 요청을하고
  * 이에 따라 적재 및 스케줄링 이후에 실 사용부서에 전달되어 라이브 완료되는 방식
* 구현 통신 구조 : 비즈니스 요건을 만족하기 위한 비즈니스 프로세스, 데이터 구조 및 시스템 설계를 정규화한 통신 구조
* 데이터 통신 구조 : 시스템간 혹은 구현체 간의 데이터를 주고 받는 프로세스

> 시스템 구조는 그 시스템을 설계하는 조직의 통신 구조를 그대로 따라갈 수밖에 없다 - 멜빈 콘웨이 Melvin Conway
* 외부에 데이터 제공을 위해 공유 Database 와 같은 안티패턴을 검토 혹은 운영하는 경우가 대표적인 예시가 될 수 있습니다
  * 급증하는 워크로드를 위해 확장(Scale-up)에도 단점이 있고 레플리카를 통한 경우도 다양한 문제(라이브 서버에 부하, 운영 비용, 보안 등)
  * 배치 프로세스가 데이터 파일 저장소를 덤프하는 경우에도 진실 공급원(sources of truth)이 복제되어 일관성이 떨어지는 문제가 있습니다
  * 이러한 구현체간의 결합을 단단히 하고 점대점으로 통신하게 만드는 경직된 아키텍처의 문제점이라 볼 수 있습니다

### 1-4. 기존 컴퓨팅의 통신 구조
> 이 책에서는 통신 구조에 방점을 두고 얘기하고 있지만, 실제로는 저장소가 확장성이 없는 관계형 데이터베이스를 가정했기 때문이 아닐까?
* NoSQL 같은 저장소로 일괄 전환될 수 있었다는 가정을 한다면 통신 방식도 달라졌을 것이라 생각이 들었습니다
* 다만, 책에서의 맥락은 과거 레거시 시스템 환경의 통신구조에 대한 얘기를 하고 싶었던 것 같습니다

### 1-5. 이벤트 기반 통신 구조
> 이벤트 스트리밍 방식은 기존과 다르게 생산/소비자 차원에서의 완전히 다른 서비스 간 통신 수단을 제안하고 있습니다
> 왜 이러한 방식으로 전환해야 하는 지에 대한 당위성을 말할 수 있어야 하는데 저장소가 NoSQL 이라고 했을 때에도 통신 구조가 바뀔 필요가 있나?
* 이벤트는 통신의 근간이다
* 이벤트 스트림은 단일 진실 공급원이다
  * 카프카 클러스터가 sources of truth 는 맞지만 누구나 마음껏 사용해도 되는 리소스 풀이 되긴 어렵다
* 컨슈머가 스스로 모델링과 쿼리를 수행한다
  * 데이터 엔지니어가 컨슈머라면 몰라도 일반 이용자가 스트림 소스에 대한 질의를 쉽게 하기 어렵다
  * 결국, 이를 해결하기 위해서 신뢰할 만한 스트림 데이터 제품을 제공해야 할 책임이 있다
* 조직 전반적으로 데이터 통신이 원활해진다
  * 모든 데이터를 사용함에 있어 생산자가 이를 제어할 필요가 없습니다
  * 결국 소비자가 필요한 소스만 필터해서 사용하는 것이 유용합니다
  * 그러기 위해서라도 안정적인 하둡 기반의 스트리밍 데이터소스가 필요합니다
* 접근 가능한 데이터 덕분에 비즈니스 통신 변경이 가능하다

### 1-6 비동기식 이벤트 기반 마이크로서비스
> 비동기식 이벤트 기반 서비스의 이점
* 세분성 (granularity) 서비스가 경계 콘텍스트에 맞게 비즈니스 요건이 바뀌어도 쉽게 재작성 가능합니다
* 확장성 (scalability) 개별 서비스 단위에서 규모를 유연하게 조절합니다
* 기술 유연성 (technological flexibility) 서비스 별 적합한 언어와 기술을 적용하며 손쉬운 프로토타입이 가능합니다
* 비즈니스 요건 유연성 (business requirement flexibility) 단위가 작은 마이크로서비스 일수록 소유권 재조정이 용이합니다
* 느슨한 결합 (loosely coupling) 특정 API 구애받지 않고 데이터 스키마에만 의존한 데이터 연결
* 지속적 전달 지원 (continuous delivery support) 쉽게 옮기고 롤백할 수 있습니다
* 우수한 시험성 (high testability) 의존성이 작아 쉬운 데이터 모킹과 테스트가 가능합니다

### 1-7 동기식 마이크로서비스
> 동기식 마이크로서비스의 단점
* 점대점 결합이나, 의존적 확장 및 서비스 실패 등 공히 동기적 API 사용에 따른 의존성 때문에 발생하는 문제점입니다
* 데이터의 접근이 구현에 종속되거나, 분산 모노리스 안티패턴 및 테스트의 어려움 등의 문제점이 발생하기 쉽습니다
* API 즉 통신방법의 결정과 시스템 아키텍처는 거의 동등한 내용이며, 동기식 마이크로서비스는 모노리스 아키텍처의 특징을 가지게 된다
  * 분산형 시스템의 경우 Stateless API + 병렬처리 + 비동기 프로세스의 특징을 가지는 반면 (마이크로 서비스 아키텍처)
  * 집중형 시스템의 경우 Stateful API + 싱글처리 + 동기 프로세스의 특징을 가지기 쉽다 (모노리스 아키텍처)


## 2장. 이벤트 기반 마이크로서비스 기초
